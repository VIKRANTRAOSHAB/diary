<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Digital Diary (Cloud Edition)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f2f5;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }
    header {
      background-color: #6200ee;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .dark-mode .container {
      background-color: #1e1e1e;
    }
    textarea, input {
      width: 100%;
      padding: 0.8rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      margin-right: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #6200ee;
      color: white;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #3700b3;
    }
    .entry {
      margin-top: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #fafafa;
    }
    .dark-mode .entry {
      background-color: #2a2a2a;
      color: white;
    }
  </style>
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA3ZZjSQq2rIPRdoT4RLl9XKjSNHwCOEWM",
      authDomain: "digital-diary-c99a7.firebaseapp.com",
      projectId: "digital-diary-c99a7",
      storageBucket: "digital-diary-c99a7.appspot.com",
      messagingSenderId: "301278550979",
      appId: "1:301278550979:web:c59b74d465ad7aaccdbb76",
      measurementId: "G-EFTTQZQNCH"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let editingId = null;

    window.saveEntry = async () => {
      const name = document.getElementById("nameInput").value.trim();
      const text = document.getElementById("diaryEntry").value.trim();
      if (!name || !text) return alert("Please enter both name and entry.");

      if (editingId) {
        const entryRef = doc(db, "entries", editingId);
        await updateDoc(entryRef, { name, text });
        editingId = null;
      } else {
        await addDoc(collection(db, "entries"), { name, text });
      }

      document.getElementById("diaryEntry").value = "";
      document.getElementById("nameInput").value = "";
      renderEntries();
    };

    window.editEntry = (id, name, text) => {
      editingId = id;
      document.getElementById("nameInput").value = name;
      document.getElementById("diaryEntry").value = text;
    };

    async function renderEntries() {
      const querySnapshot = await getDocs(collection(db, "entries"));
      const entriesDiv = document.getElementById("entries");
      entriesDiv.innerHTML = "";
      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "entry";
        div.innerHTML = `
          <strong>${data.name}</strong><br />
          <p>${data.text}</p>
          <button onclick="editEntry(\"${docSnap.id}\", \"${data.name}\", \"${data.text.replace(/\"/g, '\\\"')}\")">Edit</button>
        `;
        entriesDiv.appendChild(div);
      });
    }

    window.toggleDarkMode = () => {
      document.body.classList.toggle("dark-mode");
    };

    window.addEventListener("DOMContentLoaded", renderEntries);
  </script>
</head>
<body>
  <header>
    <h1>My Digital Diary (Cloud Edition)</h1>
  </header>
  <div class="container">
    <input type="text" id="nameInput" placeholder="Enter your name" />
    <textarea id="diaryEntry" placeholder="Write your diary entry here..."></textarea>
    <button onclick="saveEntry()">Save Entry</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
    <div id="entries"></div>
  </div>
</body>
</html>
